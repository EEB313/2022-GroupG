---
title: "EEB313 - Final Project"
Authors: "Queenny Chiu, Anna Ly, Derek Lau"
output: html_notebook
---

```{r}
library(dplyr)
library(tidyverse)
library(lubridate)
```

```{r}
mingan_flower_data <- read_csv("mingan_flower_data.csv")
head(mingan_flower_data)

mingan_weather_data <- read_csv("mingan_weather_data.csv")
head(mingan_weather_data)
```

```{r}
#changing the column name "survey_year" into "year"
colnames(mingan_flower_data)[5] <- "year"
```

```{r}
#make columns with year, month, day
dmy_weather<-mingan_weather_data %>%
mutate(date=dmy(date),
  year=lubridate::year(date),
  month=lubridate::month(date),
  day=lubridate::day(date))
dmy_weather
```

```{r}
#make column with average humidity for each month (between April and July) for each year
avg_weather <- dmy_weather%>%
  filter(month >= 4 & month <= 7 & !is.na(avg_relative_humidity) & 
           !is.na(avg_temperature)) %>% 
  group_by(month, year) %>%
  summarise(mean_avg_relative_humidity=mean(avg_relative_humidity),
            mean_avg_temp=mean(avg_temperature))
avg_weather
```

```{r}
#plot average temperature vs. average relative humidity (between April and July)
avg_weather %>%
  ggplot(aes(x=mean_avg_temp,y=mean_avg_relative_humidity))+
  geom_point() + geom_smooth(method = lm) + theme_classic()+
  labs(title = "Average Temperature vs. Average Relative Humidity 
       (between April and July)", 
       x = "Average Temperature", y = "Average Relative Humidity (%)")
```

```{r}
# Running a correlation test between average temperature and average relative humidity
cor.test(avg_weather$mean_avg_relative_humidity, avg_weather$mean_avg_temp)
```

```{r}
# find average temperature per year
mean_annual_temp <- avg_weather %>% 
  group_by(year) %>% 
  summarise(mean_annual_temp = mean(mean_avg_temp))

mean_annual_temp
```

```{r}
mean_annual_temp <- avg_weather %>% 
  group_by(year) %>% 
  summarise(mean_annual_temp = mean(mean_avg_temp))
mean_annual_temp
```

```{r}
#merge the two data into one
total <- merge(mingan_flower_data, mean_annual_temp, by="year")
total
```

```{r}
#filter out NAs
flower_temp_data <- total %>% 
  filter(!is.na(day))

flower_temp_data
```

```{r}
# create graph of temperature (x) vs. flowering day (y)

flower_temp_data %>% 
  group_by(mean_annual_temp, species_name) %>% 
  ggplot(aes(x = mean_annual_temp, y = day, colour = species_name)) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_classic()

```
```{r}
#create linear model (x = temperature, y = flowering day)

flower_temp_lm <- lm(day~mean_annual_temp, data=flower_temp_data)
summary(flower_temp_lm)
```
#p-value = 0.01275 --> Since p-value < 0.05, temperature has a significant effect on first flowering date.

```{r}
#validate assumptions
plot(flower_temp_lm, 1:2)
```
# Residuals vs. Fitted plot --> homogeneity of variances at each X is met
# Normal Q-Q --> data is normally distributed

```{r}

```

